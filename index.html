<!DOCTYPE <!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" media="screen" href="assets/style.css">
    <script src="https://momentjs.com/downloads/moment.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.10.0/firebase.js"></script>
    <script src="https://code.jquery.com/jquery.js"></script>

</head>

<body>
    <div id="titlediv">Anytime is Train time</div>
    <table class="table" id ="traintable">
        <thead>
            <tr>
                <th scope="col">Train name</th>
                <th scope="col">Destination</th>
                <th scope="col">Frequency(min)</th>
                <th scope="col">Next Arrival</th>
                <th scope="col">Minutes Away</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <th scope="row">Red Express</th>
                <td>Seattle</td>
                <td>45</td>
                <td>05:35PM</td>
                <td>10</td>
            </tr>

            <div id="addnewrows"></div>
        </tbody>
    </table>



    <div id="inputform">
        <form>
            <div class="form-group">
                <label>Train Name</label>
                <input class="form-control" id="inputtrainname" aria-describedby="emailHelp"
                    placeholder="Enter Train Name">
            </div>
            <div class="form-group">
                <label>Destination</label>
                <input class="form-control" id="destinationinput">
            </div>


            <div class="form-group">
                <label>Frequency</label>
                <input class="form-control" id="inputfrequency">
            </div>

            <div class="form-group">
                <label>First Train Time (HH:mm Military Time)</label>
                <input class="form-control" id="inputtime">
            </div>



            <button type="submit" class="btn btn-primary" id="trainsubmit">Submit</button>
        </form>

        <div id="test"></div>

    </div>



    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyAsbc8W1gndSktDT_EgLYLd0Jp2obA2Ppo",
            authDomain: "trainschedule-de5b5.firebaseapp.com",
            databaseURL: "https://trainschedule-de5b5.firebaseio.com",
            projectId: "trainschedule-de5b5",
            storageBucket: "trainschedule-de5b5.appspot.com",
            messagingSenderId: "133111300921"
        };

        firebase.initializeApp(config);


        var database = firebase.database();

        //add some initial values for train schedule

        let trainname = ""
        let destination = ""
        let frequency = ""
        let firsttraintime = ""



        $("#trainsubmit").on("click", function (event) {
            console.log("clicked button")
            event.preventDefault();

            trainname = $("#inputtrainname").val().trim()
            destination = $("#destinationinput").val().trim()
            firsttraintime = $("#inputtime").val().trim()
            frequency = $("#inputfrequency").val().trim()

            console.log(frequency)



            //code to handle push to firebase 
            database.ref().push({
                trainname: trainname,
                destination: destination,
                firsttraintime: firsttraintime,
                frequency: frequency,
                dateAdded: firebase.database.ServerValue.TIMESTAMP
            });

        });

        // Firebase watcher + initial loader HINT: This code behaves similarly to .on("value")
        database.ref().on("child_added", function (childSnapshot) {
            // full list of items to the well
            $("#traintable").append("<tr>" +
                "<th scope='row'>" + childSnapshot.val().trainname + "</th>" +
                "<td> " + childSnapshot.val().destination + " </td>" +
                "<td> " + childSnapshot.val().frequency + " </td>" +
                "<td> " + childSnapshot.val().frequency + " </td>" +
                "<td> " + childSnapshot.val().frequency + " </td>" +
                "</tr>");

            // Handle the errors
        }, function (errorObject) {
            console.log("Errors handled: " + errorObject.code);
        });
        console.log(moment().format('LT'));
    </script>
</body>

</html>